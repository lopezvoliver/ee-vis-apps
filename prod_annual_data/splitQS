var fields = ee.FeatureCollection("projects/halo-mewa/assets/fields/tli-v0/2022");
var regions = ee.FeatureCollection("projects/halo-mewa/assets/regions-multi");
    
// Pre-split the QS fields (computation is too large!!)
// e.g. first export QS fields as large batches (property: S)
// there are about 20,000 fields
// Let's make collections of 5,000 fields each
// then we can use the 500-size batch process for
// each 5000 fields -- which we know works. 
var split = require("users/oliverlopez/mewa-apps:util/splitFC")
var region = regions.filter(ee.Filter.eq("region","QS"))
var f = fields.filterBounds(region).sort("uid")
//print(f.size())
//print(f.limit(5))
var ff= ee.FeatureCollection(split.s(f, 5000, "S"))
// Export each collection separately -- we know how many we will have!
// 2022: 19449 -- so there are 4 collections of ~5000 each
function do_export(n){
  var C = ff.filter(ee.Filter.eq("S",n))
  Export.table.toAsset({
    collection: C,
    description: "split-QS-"+n,
    assetId:"projects/halo-mewa/assets/fields/tli-v0/2022-QS-"+n
  })
}
[1,2,3,4].map(do_export)
